#!/bin/sh -x

# create database with name as dish_test
DATABASE_NAME='dish_test'
if psql -lqt | cut -d \| -f 1 | grep -qw $DATABASE_NAME; then
    echo "A database with the name $DBNAME already exists."
    echo "Drop $DATABASE_NAME and create a new one."
    dropdb $DATABASE_NAME
fi
createdb $DATABASE_NAME

# Export the environment variables and set up for the server
export DATABASE_URL='postgresql://localhost:5432/dish_test' 
export ADMIN_TOKEN='eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6Ik56RXpNemt6UmtFMVFrTkdSREF5TkRJek1Ea3hSRGhFT1RJNFJFWTJNek5HUWtaRFJUY3dSQSJ9.eyJpc3MiOiJodHRwczovL2Rldi1hdXRoMi5hdXRoMC5jb20vIiwic3ViIjoiYXV0aDB8NWU2NDg2NDVjNmRiYzkwZDNkZTJkMDdjIiwiYXVkIjoiRGlzaGVzIiwiaWF0IjoxNTkyNTM2ODU1LCJleHAiOjE1OTI2MjMyNTUsImF6cCI6ImVDYzRCdGM2RU9OY1VMYTFzY0VXaUlCMzJ4M1BaeEJkIiwic2NvcGUiOiIiLCJwZXJtaXNzaW9ucyI6WyJkZWxldGU6Y2F0ZWdvcmllcyIsImRlbGV0ZTpkaXNoZXMiLCJkZWxldGU6cmVzdGF1cmFudHMiLCJnZXQ6Y2F0ZWdvcmllcyIsImdldDpkaXNoZXMiLCJnZXQ6cmVzdGF1cmFudHMiLCJwYXRjaDpjYXRlZ29yaWVzIiwicGF0Y2g6ZGlzaGVzIiwicGF0Y2g6cmVzdGF1cmFudHMiLCJwb3N0OmNhdGVnb3JpZXMiLCJwb3N0OmRpc2hlcyIsInBvc3Q6cmVzdGF1cmFudHMiXX0.OaddkmoSOi0dFUvWcMXw3qpAYKPY3a4FCzBo46PRJUNndHlrJQsIuW7yDO5G8u17J6PIvTmUv-oe3Rzw6_qGWniq3vd2wSjSbOwr1olIWKfjq4AxC__pmBPgmQestnqatxYdLxdKO0V9Ccu78Qk3QjZFRioVrMmYTh07p5X_vjRDMJhcc9A_W2Nryd2gm1nkcJlC7p0-Ef4XohfiaA66Q1FXqXj6-nfespPvh4cIojfQTNy7aj0usfis67hFBppkiNQn5oZt2_3ife704kv5tAFcJdfEW5cRcpAkJM5yPdjFwNAQytRCkFbWfUMFkMATIkCMonWoz4-y9odeaZAMiA'
export USER_TOKEN='eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6Ik56RXpNemt6UmtFMVFrTkdSREF5TkRJek1Ea3hSRGhFT1RJNFJFWTJNek5HUWtaRFJUY3dSQSJ9.eyJpc3MiOiJodHRwczovL2Rldi1hdXRoMi5hdXRoMC5jb20vIiwic3ViIjoiYXV0aDB8NWU5NTVhN2MzNDdlYjAwYzE3MThhM2MzIiwiYXVkIjoiRGlzaGVzIiwiaWF0IjoxNTkyNTM2OTI3LCJleHAiOjE1OTI2MjMzMjcsImF6cCI6ImVDYzRCdGM2RU9OY1VMYTFzY0VXaUlCMzJ4M1BaeEJkIiwic2NvcGUiOiIiLCJwZXJtaXNzaW9ucyI6WyJnZXQ6Y2F0ZWdvcmllcyIsImdldDpkaXNoZXMiLCJnZXQ6cmVzdGF1cmFudHMiXX0.nwToR8EE5_TvHhoVmuBlaGT_cXYX1z0yLIMo8dzCUifASYlxsnxklY_SY0U3ZVrWrNiTY1Hp4alZNsyRUkcVQbwWhaPoalbwWRddzk0vScKoe4b3bB9S-jFVsa3Bt-sEjTKQlEKNk196LPvBd9sG9bcnMkHOpwxElByWiusIUn1OtAL6Bi9Vrjm5itcl265Muk65Ur6Q0IhLtKhyjN9yM8wUfUAIvAUzNtAR35TOT_zDlaAsoH_2w9GQxOflZmK74xg-U2EiZkhGM3svFXmAexwT2KCB4-8LEZ4n640s2rRuDNxvamaRCxtOLPtONNda8pEacccLXzZURI47R9NNCA' 
python3 -m backend.src.test -v